Title         : `MyStyle.mdk`

Affiliation   : The University of Tokyo, Department of Indian Philosophy and Buddhist Studies

<!--
Here is the bad character: 
!-->

<!-- BEGIN:Style -->

BibTeX        : False
Logo          : False
Doc class     : [10pt]article
Package       : [a4paper]geometry
Package       : [all,defaultlines=3]nowidow
Package       : xltxtra, xunicode
Package       : fontspec
Package       : [AutoFallBack=true]xeCJK
Package       : [normalem]ulem
Package       : hyperref
Package       : [nooverlap,CJK]ruby

<!--Package       : pxrubrica
try{pxrubrica} a newish ruby package.
Ok, I tried it. it didn't work. seems to not be compatible fully with XeLetex -->


<!--- Font Options for Madoko and Latex: -->

main_font  : Linux Libertine O

<!--
Linux Libertine O, JUnicode, Iowan Old Style
!-->

CJK_main_Font : MS Mincho
CJK_sans_font : Noto Sans CJK JP Regular

<!-- not tested
Hiragino Mincho Pro, HanaMinA Regular, Iowan Old Style
Tested: MS Gothic; MS PMincho but doesn't display in preview for some reason
!-->

Japanese_Font : MS Mincho
CJKFallBack_Font : HanaMinA

Tex Header    : \defaultfontfeatures{Mapping=tex-text}
Tex Header    : \setmainfont {&main_font;}
Tex Header    : \setCJKmainfont [AutoFakeBold=false,AutoFakeSlant=false]{&cjk_main_font;}
Tex Header    : \setCJKsansfont [AutoFakeBold=false,AutoFakeSlant=false]{&cjk_sans_font;}
Tex Header    : \setCJKfallbackfamilyfont{rm}{&CJKFallBack_Font;}
Tex Header    : \setCJKfallbackfamilyfont{\CJKrmdefault}{&CJKFallBack_Font;}

Tex Header    : \newCJKfontfamily{\jpfont}{&Japanese_Font;}

Tex Header    : \setCJKfallbackfamilyfont{jpfont}{&CJKFallBack_Font;}


<!--
Package       : [pagewise] lineno 
Tex Header    : \linenumbers
Tex Header    : \modulolinenumbers[5]
Tex Header    : \renewcommand\linenumberfont{\textrm{\small}}
Tex Header    : \setlength\linenumbersep{20pt}
!-->


leftheadertext : &date;
rightheadertext: Tom Newhall

package       : fancyhdr

headeron      : True
footeron      : True
Draft         : False
draft_text    : \colorbox{red}{Draft-not for citation}



@if headeron  { 
Tex Header    :	\setlength{\headheight}{17 pt}
Tex Header    : \pagestyle{fancy}
Tex Header    :	\lhead{\footnotesize &leftheadertext;}
Tex Header    :	\rhead{\footnotesize &rightheadertext;} 
                }

@if Draft  {  Tex Header    : \chead{&draft_text;}  }

@if footeron  { Tex Header    : \cfoot{Newhall \thepage}  }

    <!--- Useful Symbols and additional entities -->

default_highlight_color: yellow

genbun        : [åŸâ–¶ï¸]{margin-left:-2em; padding: 2px; border:"solid black 1px";}
kundoku       : [è¨“â–¶ï¸]{margin-left:-2em; padding: 2px; border:"solid black 1px";}
honyaku       : [è¨³â–¶ï¸]{margin-left:-2em; padding: 2px; border:"solid black 1px";}

excl          : !
ditto         : ã€ƒ
approx        : â‰’
about         : â‰ˆ
notequal      : â‰ 

verylightsalmon : hsl(15,80%,85%)


verse_text_color        : darkblue
verse_background_color  : lightblue

    <!-- ----------------------------------- !-->
    <!-- Begineth the furigana/rubies module !-->
    <!-- ----------------------------------- !-->

<!--- The rubies unit basically works like this:
 1. Find a string of kanji followed by a string of rubies
  - More specifically, find string of one or more kanji with some hiragana (+spacing delimiters) inside of parentheses
  - the characters that are defined kanji are defined by the `base_kanji_range` variable
  - strings of kanji can be split up by a space. For instance consider the strings `å¤©å°æ™ºé¡—(ã¡ã)` and `å¤©å° æ™ºé¡—(ã¡ã)`. The first will put the rubies `ã¡ã` over the whole string `å¤©å°æ™ºé¡—` while the latter will only put it over the characters `æ™ºé¡—`. If only one space is left between such strings of kanji, the two strings will appear concatenated (i.e. without a space) in the final output. `
  - Characters that are defined as parentheses are defined specifically by `ruby_opening_delimiters` and `ruby_closing_delimiters`. By changing these variables, you can, for example, use different characters and different brackets such as `{` and `}` for typing furigana.
  - Characters that can be used for rubies are defined by `&furigana_range;`. In this first step characters that are defined as `furigana_spacers` and `okurigana_spacers` are also grabbed into the "string of rubies"
  - This string of kanji + furigana is "normalized", that is to say, put into the form of [<kanji>(<furigana>)]{.rubies} and labeled with `.rubies` for further processing.
  - This means that any string, even if the contain characters that are normally included in the definition of furigana or kanji, can be made into rubies with by putting it in the above mentioned format. I.e. you would normally not be able to type `çŒ«(neko)` and have it automatically produce rubies, but if you typed `[çŒ«(neko)]{.rubies}` it should print `neko` above `çŒ«`. Similarly `[Cat(çŒ«)]{.rubies}` should print `çŒ«` above `Cat`.
 2. If the string of rubies has okurigana or furigana delimiters in them, break the strings up into smaller strings
  2.1 If the string of rubies has an Okurigana spacer in it, everything after this spacer should be put above a blank space, and everything before it should be put above the kanji
    - Characters used for okurigana spacers are defined by `okurigana_spacers`. By default this is a bar |, but you can change that or add to it if you like.
    - so for instance the string of rubies for ç…©æ‚©(ã¼ã‚“ã®ã†|ã‚’) would be split up into `ã¼ã‚“ã®ã†` and `ã‚’` with the `ã‚’` appearing over a blank space after `ç…©æ‚©`.
    - Technically, the string of rubies before the okurigana spacer are not directly "put above the kanji" but are put into the normalized ruby format, and labeled as `.rubies`. 
    - so technically `ç…©æ‚©(ã¼ã‚“ã®ã†|ã‚’)` becomes `[ç…©æ‚©(ã¼ã‚“ã®ã†)]{.rubies}[[&emsp;][ã‚’]{.ruby-text}]{.base-kanji}`
  2.2 If the string of rubies has one or more furigana spacers in it, put everything after the spacer above the last character in the string of kanji, and everthing before the spacer above the rest of the kanji.
    - Once again, furigana spacer are defined by `furigana_spacers`. This defaults to the middle dot, easily typed with the (mac) japanese IME, or a space, or a hyphen
    - For instance, the string of rubies for `è«¸ç…©æ‚©(ã—ã‚‡ãƒ»ã¼ã‚“ãƒ»ã®ã†)` is split into `ã—ã‚‡ãƒ»ã¼ã‚“` and `ã®ã†` while the string of kanji is broken into `è«¸ç…©` and `æ‚©`, with `ã®ã†` appearing over the character `æ‚©`.
    - Technically, all the characters in the kanji string except the last one, plus all the rubies before the delimiter are put in a normalized format and labeled with the `.rubies` to be sent to the `.rubies` unit, while the last character of the kanji string and the characters after the delimiter are rendered.
    - Specifically,`è«¸ç…©æ‚©(ã—ã‚‡ãƒ»ã¼ã‚“ãƒ»ã®ã†)` gets transformed into `[è«¸ç…©(ã—ã‚‡ãƒ»ã¼ã‚“)]{.rubies}[æ‚©[ã®ã†]{.ruby-text}]{.base-kanji}
    - Notice that this is a recursive operation. After the ` æ‚©` and `ã®ã†` have been parsed out, the same operation happens with `è«¸ç…©` and `ã—ã‚‡ãƒ»ã¼ã‚“` until there are no strings with furigana delimiters left. Essentially, this is how the correct furigana is put over the correct kanji. 
    - Note that this assumes that the string of furigana after the last furigana delimiter is associated with the last character in the string of kanji.
    - That is to say that, for example typing è«¸ç…©æ‚©(ã—ã‚‡ãƒ»ã¼ã‚“ã®ã†) would be parsed as è«¸ç…©(ã—ã‚‡) and æ‚©(ã¼ã‚“ã®ã†) which is incorrect. The way to avoid this would be to type something like `è«¸ç…©æ‚©(ã—ã‚‡ãƒ»ã¼ã‚“ãƒ»ã®ã†)`, as above or `è«¸(ã—ã‚‡)ç…©æ‚©(ã¼ã‚“ãƒ»ã®ã†)`
    - Because the the space character `(`\s`) and hyphens are included in `furigana_spacers` you could also type the above as è«¸ç…©æ‚©(ã—ã‚‡ ã¼ã‚“ ã®ã†) or è«¸ç…©æ‚©(ã—ã‚‡-ã¼ã‚“-ã®ã†), if you prefer.
  3. Once all the strings of kanji and strings of rubies that were labeled `.rubies` have been split up into smaller "normalized" strings of kanji and strings of rubies, and there are no more strings of rubies that have furigana or okurigana delimiters left, then label the string of kanji as `.base-kanji` and the strings of ruby text as `.ruby-text`
    - its actually a little more complex than that, as they have to be in a particular format, but this is actually the most fundamental thing this whole unit does.
    - from the example above `ç…©æ‚©ï¼ˆã¼ã‚“ã®ã†ï¼‰` first becomes `[ç…©æ‚©(ã¼ã‚“ã®ã†)]{.rubies}` (step 1) which then becomes [ç…©æ‚©[ã¼ã‚“ã®ã†]{.ruby-text}]{.base-kanji}
  4. These tags are then converted to appropriate HTML/CSS or LaTeX, and rendered. 
  - In the HTML/CSS version, the whole string of base kanji+ruby-text is surrounded by <ruby> tags, while the `ruby-text` tagged with the <rt> (short for ruby-text)tag.
    - so `[ç…©æ‚©[ã¼ã‚“ã®ã†]{.ruby-text}]{.base-kanji}` becomes `<ruby>ç…©æ‚©<rt>ã¼ã‚“ã®ã†<rt></ruby>`
  - In the LaTeX version, the command `\ruby` is added, with the base-kanji text and ruby-text surrounded by brackets `{}`, respectively.
    - so `[ç…©æ‚©[ã¼ã‚“ã®ã†]{.ruby-text}]{.base-kanji}` becomes `\ruby{ç…©æ‚©}{ã¼ã‚“ã®ã†}`
    - This requires the `ruby` package, which is automatically loaded with this style file. 
    - Or, to make a long story short, this whole thing does this: 
    (simple example):
     0. ç…©æ‚©ï¼ˆã¼ã‚“ã®ã†ï¼‰
     1. [ç…©æ‚©ï¼ˆã¼ã‚“ã®ã†ï¼‰]{.rubies}
     2. <no delimiters in this example, so skip step 2>
     3. [[ç…©æ‚©[ã¼ã‚“ã®ã†]{.ruby-text}]{.base-kanji}
     4a. (html) <ruby>ç…©æ‚©<rt>ã¼ã‚“ã®ã†<rt></ruby>
     4b. (latex) \ruby{ç…©æ‚©}{ã¼ã‚“ã®ã†}
     
  (complex example, with delimiters and a non-ruby kanji):
    0. æ­¤ è«¸ç…©æ‚©ï¼ˆã—ã‚‡ãƒ»ã¼ã‚“ãƒ»ã®ã†ï¼‰
    1. æ­¤[è«¸ç…©æ‚©ï¼ˆã—ã‚‡ãƒ»ã¼ã‚“ãƒ»ã®ã†ï¼‰]{.rubies}
    2a. æ­¤[è«¸ç…©ï¼ˆã—ã‚‡ãƒ»ã¼ã‚“ï¼‰]{.rubies}[æ‚©[ã®ã†]{.ruby-text}]{.base-kanji}
    2b. æ­¤[è«¸(ã—ã‚‡)]{.rubies}[[ç…©][ã¼ã‚“]{.ruby-text}]{.base-kanji}[æ‚©[ã®ã†]{.ruby-text}]{.base-kanji}
    3. æ­¤[[è«¸[ã—ã‚‡]{.ruby-text}]{.base-kanji}[[ç…©][ã¼ã‚“]{.ruby-text}]{.base-kanji}[æ‚©[ã®ã†]{.ruby-text}]{.base-kanji}
    4a. (HTML) æ­¤<ruby>è«¸<rt>ã—ã‚‡</rt></ruby><ruby>ç…©<rt>ã¼ã‚“</rt></ruby><ruby><rt>æ‚©<rt>ã®ã†</rt></ruby>
    4b. (LaTeX) æ­¤\ruby{è«¸}{ã—ã‚‡}\ruby{ç…©}{ã¼ã‚“}\ruby{æ‚©}{ã®ã†}
    The end.
    --->

         <!-- General Options !-->

rubysep       : -0.1em
rubysize      : 0.4

Tex Header    : \renewcommand{\rubysep}{&rubysep;}
Tex Header    : \renewcommand{\rubysize}{&rubysize;}

base_kanji_range: \u3400-\u9FFFã€…ã†‘ã†’ã†“ã†”ã†–ã†—ã†˜

 <!--Set the regex range that the ruby function will detect as the base character for the rubies. Default is `\u4E00-\u9FFF`, the Unicode range for Kanji, though you could theoretically use this function for other types of characters.!-->

furigana_range:\u3040-\u30FFa-zA-ZÃ€-ã¿

<!--Set the regex range that the ruby function will detect as 'ruby' (furigana) characters. The default is `\u3040-\u30FF`, the Unicode range that includes Hiragana and Katakana, though you may want to add functionality for alphabetical characters by adding ` a-zA-Z` or numbers `0-9`, or possibly even certain kanji.!-->

furigana_spacers: \s,ãƒ»\-â€

<!-- \u3000 should be the IDEOGRAPHIC SPACEã€€!-->

<!--Set the regex range that the ruby function will detect to separate blocks of furigana. The default is `|` (vertical line/pipe) which has to be escaped as `\|`. You may want to add other separators such as the middle dot `ãƒ»`, which may be easier to type when typing with a Japanese IME.!-->

okurigana_spacers:ï½œ|

<!--Set the regex range that the ruby function will detect to separate furigana from okurigana characters. The default is `|` (vertical line/pipe) which has to be escaped as `\|`. You may want to add other separators such as the middle dot `ãƒ»`, which may be easier to type when typing with a Japanese IME.! For whatever reason the japanese full-width pipe character doesn't seem to be working. -->

ruby_opening_delimiters: ï¼ˆ\(
ruby_closing_delimiters: \)ï¼‰


<!-- Supposed to allow you to make rubies unselectable in the html, but may not work in chrome: -->

rubies_selectable: True

<!-- The main "ruby grabber" for the whole document. This basically grabs two stringgs. First, it grabs a string of at one or more characters in the "base kanji range." If a space  separates two kanji characters, these are treated as separate groups. This string of kanji is followed by a string of one "opening delimiter" character followed by at least one character in the "furigana range," optional "furigana spacer"s or "okurigana spacer"s, and a single "closing delimiter character". and then renders this as strings separated by parentheses `()` that go to the `.rubies` unit. This is done so that you can also use any strings of the form [XX(YYY)]{.rubies} to create rubies, while the default only matches kanji at the base and hiragana for the ruby characters!-->

.madoko { replace :  "/(([&base_kanji_range;]+)\s)?([&base_kanji_range;]+?)\
                      [&ruby_opening_delimiters;]([&furigana_range;&furigana_spacers;&okurigana_spacers;]+?)[&ruby_closing_delimiters;]/\
                      \2[\3(\4)]{.rubies}/g"  ; }

<!-- Here, text from the above is parsed into either a string with furigana or okurigana spacers, or one without those spacers. The one without is sent to `.ruby-text` and `.base-kanji`, the furigana rendering styles !-->

<!-- The case with either furigana spaces or okurigana spacers: !-->

.rubies { replace : "/(.+?)\((.+?[&furigana_spacers;&okurigana_spacers;].+?)\)/\
                    [\1(\2)]{.spaced-out-rubies}/g" ;  }

blacksanta    : &#127877;&#127999;


<!-- The general case, without spacers: !-->

.rubies { replace :  "/(.+)\(([^&furigana_spacers;&okurigana_spacers;]+?)\)/\
                      [\1[\2]{.ruby-text}]{.base-kanji}/g"  ; }

<!-- Rubies that follow an okurigana spacers are directly rendered, with their "base kanji" as a blank space `&ensp;`. The remaining kanji and furigana that precede the spacer are then sent to the `.rubies` unit and will be parsed from there !-->


.spaced-out-rubies {  replace :  "/(.+?)(.)\((.+)[&furigana_spacers;](.+?)\)/\
                                  [\1(\3)]{.rubies}[\2(\4)]{.rubies}/g"  ; }

.spaced-out-rubies {  replace :  "/(.+?)\((.+)[&okurigana_spacers;](.+?)\)/\
                                  [\1(\2)]{.rubies}[&ensp;[\3]{.ruby-text}]{.base-kanji}/g" ;  }


<!-- Then, rubies spaced out by the furigana spacers are separated into sets of <kanji>(<furigana>). The the final group of furigana is stripped of spacers, coupled with the last kanji, and then is sent back to the .rubies unit to be rendered. The remaning kanji and furigana are grouped together and sent back to .rubies. If there are remaning "spacers" then tey will get sent back here, otherwise will be rendered as kanji with rubies !-->


.base-kanji { html-elem : "ruby"  ;
              tex-cmd   : "\ruby" ; }

.ruby-text {
    html-elem:"rt";
    tex-cmd-before:"}{";
}

@if not rubies_selectable {
                      .rt { -webkit-touch-callout : none  ;
                            -webkit-user-select   : none  ;
                            -khtml-user-select    : none  ;
                            -moz-user-select      : none  ;
                            -ms-user-select       : none  ;
                            user-select           : none  ;  } }


      <!-- Kanji Checker module !-->

joyo_kanji: äºœå“€æŒ¨æ„›æ›–æ‚ªæ¡åœ§æ‰±å®›åµå®‰æ¡ˆæš—ä»¥è¡£ä½å›²åŒ»ä¾å§”å¨ç‚ºç•èƒƒå°‰ç•°ç§»èå‰æ¤…å½™æ„é•ç¶­æ…°éºç·¯åŸŸè‚²ä¸€å£±é€¸èŒ¨èŠ‹å¼•å°å› å’½å§»å“¡é™¢æ·«é™°é£²éš éŸ»å³å®‡ç¾½é›¨å”„é¬±ç•æµ¦é‹é›²æ°¸æ³³è‹±æ˜ æ „å–¶è© å½±é‹­è¡›æ˜“ç–«ç›Šæ¶²é§…æ‚¦è¶Šè¬é–²å††å»¶æ²¿ç‚å®´æ€¨åª›æ´åœ’ç…™çŒ¿é é‰›å¡©æ¼”ç¸è‰¶æ±šç‹å‡¹å¤®å¿œå¾€æŠ¼æ—ºæ¬§æ®´æ¡œç¿å¥¥æ¨ªå²¡å±‹å„„æ†¶è‡†è™ä¹™ä¿ºå¸éŸ³æ©æ¸©ç©ä¸‹åŒ–ç«åŠ å¯ä»®ä½•èŠ±ä½³ä¾¡æœæ²³è‹›ç§‘æ¶å¤å®¶è·è¯è“è²¨æ¸¦éå«æš‡ç¦é´å¯¡æ­Œç®‡ç¨¼èª²èšŠç‰™ç“¦æˆ‘ç”»èŠ½è³€é›…é¤“ä»‹å›ç°ä¼šå¿«æˆ’æ”¹æ€ªæ‹æ‚”æµ·ç•Œçš†æ¢°çµµé–‹éšå¡Šæ¥·è§£æ½°å£Šæ‡è«§è²å¤–åŠ¾å®³å´–æ¶¯è¡—æ…¨è“‹è©²æ¦‚éª¸å£æŸ¿å„è§’æ‹¡é©æ ¼æ ¸æ®»éƒ­è¦šè¼ƒéš”é–£ç¢ºç²åš‡ç©«å­¦å²³æ¥½é¡é¡æ›æ½Ÿæ‹¬æ´»å–æ¸‡å‰²è‘›æ»‘è¤è½„ä¸”æ ªé‡œéŒåˆˆå¹²åˆŠç”˜æ±—ç¼¶å®Œè‚å®˜å† å·»çœ‹é™¥ä¹¾å‹˜æ‚£è²«å¯’å–šå ªæ›æ•¢æ£ºæ¬¾é–“é–‘å‹§å¯›å¹¹æ„Ÿæ¼¢æ…£ç®¡é–¢æ­“ç›£ç·©æ†¾é‚„é¤¨ç’°ç°¡è¦³éŸ“è‰¦é‘‘ä¸¸å«å²¸å²©ç©çœ¼é ‘é¡”é¡˜ä¼ä¼å±æœºæ°—å²å¸Œå¿Œæ±½å¥‡ç¥ˆå­£ç´€è»Œæ—¢è¨˜èµ·é£¢é¬¼å¸°åŸºå¯„è¦äº€å–œå¹¾æ®æœŸæ£‹è²´æ£„æ¯€æ——å™¨ç•¿è¼æ©Ÿé¨æŠ€å®œå½æ¬ºç¾©ç–‘å„€æˆ¯æ“¬çŠ è­°èŠå‰å–«è©°å´å®¢è„šé€†è™ä¹ä¹…åŠå¼“ä¸˜æ—§ä¼‘å¸æœ½è‡¼æ±‚ç©¶æ³£æ€¥ç´šç³¾å®®æ•‘çƒçµ¦å—…çª®ç‰›å»å·¨å±…æ‹’æ‹ æŒ™è™šè¨±è·é­šå¾¡æ¼å‡¶å…±å«ç‹‚äº¬äº«ä¾›å”æ³å³¡æŒŸç‹­ææ­èƒ¸è„…å¼·æ•™éƒ·å¢ƒæ©‹çŸ¯é¡ç«¶éŸ¿é©šä»°æšæ¥­å‡æ›²å±€æ¥µç‰å·¾æ–¤å‡è¿‘é‡‘èŒå‹¤ç´ç­‹åƒ…ç¦ç·ŠéŒ¦è¬¹è¥ŸåŸéŠ€åŒºå¥è‹¦é§†å…·æƒ§æ„šç©ºå¶é‡éš…ä¸²å±ˆæ˜çªŸç†Šç¹°å›è¨“å‹²è–«è»éƒ¡ç¾¤å…„åˆ‘å½¢ç³»å¾„èŒä¿‚å‹å¥‘è¨ˆæµå•“æ²æ¸“çµŒè›æ•¬æ™¯è»½å‚¾æºç¶™è©£æ…¶æ†¬ç¨½æ†©è­¦é¶èŠ¸è¿é¯¨éš™åŠ‡æ’ƒæ¿€æ¡æ¬ ç©´è¡€æ±ºçµå‚‘æ½”æœˆçŠ¬ä»¶è¦‹åˆ¸è‚©å»ºç ”çœŒå€¹å…¼å‰£æ‹³è»’å¥é™ºåœå …æ¤œå«ŒçŒ®çµ¹é£æ¨©æ†²è³¢è¬™éµç¹­é¡•é¨“æ‡¸å…ƒå¹»ç„è¨€å¼¦é™åŸç¾èˆ·æ¸›æºå³å·±æˆ¸å¤å‘¼å›ºå­¤å¼§è‚¡è™æ•…æ¯å€‹åº«æ¹–é›‡èª‡é¼“éŒ®é¡§äº”äº’åˆå‘‰å¾Œå¨¯æ‚Ÿç¢èªèª¤è­·å£å·¥å…¬å‹¾å­”åŠŸå·§åºƒç”²äº¤å…‰å‘åå¥½æ±Ÿè€ƒè¡Œå‘å­æŠ—æ”»æ›´åŠ¹å¹¸æ‹˜è‚¯ä¾¯åšæ’æ´ªçš‡ç´…è’éƒŠé¦™å€™æ ¡è€•èˆªè²¢é™é«˜åº·æ§æ¢—é»„å–‰æ…Œæ¸¯ç¡¬çµé …æºé‰±æ§‹ç¶±é…µç¨¿èˆˆè¡¡é‹¼è¬›è³¼ä¹å·åˆæ‹·å‰›å‚²è±ªå…‹å‘Šè°·åˆ»å›½é»’ç©€é…·ç„éª¨é§’è¾¼é ƒä»Šå›°æ˜†æ¨æ ¹å©šæ··ç—•ç´ºé­‚å¢¾æ‡‡å·¦ä½æ²™æŸ»ç ‚å”†å·®è©é–åº§æŒ«æ‰å†ç½å¦»é‡‡ç •å®°æ ½å½©æ¡æ¸ˆç¥­æ–ç´°èœæœ€è£å‚µå‚¬å¡æ­³è¼‰éš›åŸ¼åœ¨æå‰¤è²¡ç½ªå´ä½œå‰Šæ˜¨æŸµç´¢ç­–é…¢æ¾éŒ¯å’²å†Šæœ­åˆ·åˆ¹æ‹¶æ®ºå¯Ÿæ’®æ“¦é›‘çš¿ä¸‰å±±å‚æ¡Ÿèš•æƒ¨ç”£å‚˜æ•£ç®—é…¸è³›æ®‹æ–¬æš«å£«å­æ”¯æ­¢æ°ä»•å²å¸å››å¸‚çŸ¢æ—¨æ­»ç³¸è‡³ä¼ºå¿—ç§ä½¿åˆºå§‹å§‰æç¥‰è‚¢å§¿æ€æŒ‡æ–½å¸«æ£ç´™è„‚è¦–ç´«è©æ­¯å—£è©¦è©©è³‡é£¼èªŒé›Œæ‘¯è³œè«®ç¤ºå­—å¯ºæ¬¡è€³è‡ªä¼¼å…äº‹ä¾æ²»æŒæ™‚æ»‹æ…ˆè¾ç£é¤Œç’½é¹¿å¼è­˜è»¸ä¸ƒå±å¤±å®¤ç–¾åŸ·æ¹¿å«‰æ¼†è³ªå®ŸèŠå†™ç¤¾è»Šèˆè€…å°„æ¨èµ¦æ–œç…®é®è¬é‚ªè›‡å°ºå€Ÿé…Œé‡ˆçˆµè‹¥å¼±å¯‚æ‰‹ä¸»å®ˆæœ±å–ç‹©é¦–æ®Šç é…’è…«ç¨®è¶£å¯¿å—å‘ªæˆéœ€å„’æ¨¹åå›šå·èˆŸç§€å‘¨å®—æ‹¾ç§‹è‡­ä¿®è¢–çµ‚ç¾ç¿’é€±å°±è¡†é›†æ„é…¬é†œè¹´è¥²åæ±å……ä½æŸ”é‡å¾“æ¸‹éŠƒç£ç¸¦å”ç¥å®¿æ·‘ç²›ç¸®å¡¾ç†Ÿå‡ºè¿°è¡“ä¿Šæ˜¥ç¬æ—¬å·¡ç›¾å‡†æ®‰ç´”å¾ªé †æº–æ½¤éµå‡¦åˆæ‰€æ›¸åº¶æš‘ç½²ç·’è«¸å¥³å¦‚åŠ©åºå™å¾é™¤å°å‡å°‘å¬åŒ åºŠæŠ„è‚–å°šæ‹›æ‰¿æ˜‡æ¾æ²¼æ˜­å®µå°†æ¶ˆç—‡ç¥¥ç§°ç¬‘å”±å•†æ¸‰ç« ç´¹è¨Ÿå‹æŒæ™¶ç„¼ç„¦ç¡ç²§è©”è¨¼è±¡å‚·å¥¨ç…§è©³å½°éšœæ†§è¡è³å„Ÿç¤é˜ä¸Šä¸ˆå†—æ¡çŠ¶ä¹—åŸæµ„å‰°å¸¸æƒ…å ´ç•³è’¸ç¸„å£Œå¬¢éŒ è­²é†¸è‰²æ‹­é£Ÿæ¤æ®–é£¾è§¦å˜±ç¹”è·è¾±å°»å¿ƒç”³ä¼¸è‡£èŠ¯èº«è¾›ä¾µä¿¡æ´¥ç¥å”‡å¨ æŒ¯æµ¸çœŸé‡æ·±ç´³é€²æ£®è¨ºå¯æ…æ–°å¯©éœ‡è–ªè¦ªäººåˆƒä»å°½è¿…ç”šé™£å°‹è…é ˆå›³æ°´å¹å‚ç‚Šå¸¥ç²‹è¡°æ¨é…”é‚ç¡ç©‚éšé«„æ¢å´‡æ•°æ®æ‰è£¾å¯¸ç€¬æ˜¯äº•ä¸–æ­£ç”Ÿæˆè¥¿å£°åˆ¶å§“å¾æ€§é’æ–‰æ”¿æ˜Ÿç‰²çœå‡„é€æ¸…ç››å©¿æ™´å‹¢è–èª ç²¾è£½èª“é™è«‹æ•´é†’ç¨å¤•æ–¥çŸ³èµ¤æ˜”æå¸­è„Šéš»æƒœæˆšè²¬è·¡ç©ç¸¾ç±åˆ‡æŠ˜æ‹™çªƒæ¥è¨­é›ªæ‘‚ç¯€èª¬èˆŒçµ¶åƒå·ä»™å å…ˆå®£å°‚æ³‰æµ…æ´—æŸ“æ‰‡æ “æ—‹èˆ¹æˆ¦ç…ç¾¨è…ºè©®è·µç®‹éŠ­æ½œç·šé·é¸è–¦ç¹Šé®®å…¨å‰å–„ç„¶ç¦…æ¼¸è†³ç¹•ç‹™é˜»ç¥–ç§Ÿç´ æªç²—çµ„ç–è¨´å¡‘é¡ç¤åŒå£®æ—©äº‰èµ°å¥ç›¸è˜è‰é€å€‰æœæŒ¿æ¡‘å·£æƒæ›¹æ›½çˆ½çª“å‰µå–ªç—©è‘¬è£…åƒ§æƒ³å±¤ç·é­æ§½è¸ªæ“ç‡¥éœœé¨’è—»é€ åƒå¢—æ†è”µè´ˆè‡“å³æŸè¶³ä¿ƒå‰‡æ¯æ‰é€Ÿå´æ¸¬ä¿—æ—å±è³Šç¶šå’ç‡å­˜æ‘å­«å°Šæéœä»–å¤šæ±°æ‰“å¦¥å”¾å •æƒ°é§„å¤ªå¯¾ä½“è€å¾…æ€ èƒé€€å¸¯æ³°å †è¢‹é€®æ›¿è²¸éšŠæ»æ…‹æˆ´å¤§ä»£å°ç¬¬é¡Œæ»å®…æŠæ²¢å“æ‹“è¨—æ¿¯è«¾æ¿ä½†é”è„±å¥ªæ£šèª°ä¸¹æ—¦æ‹…å˜ç‚­èƒ†æ¢æ·¡çŸ­å˜†ç«¯ç¶»èª•é›å›£ç”·æ®µæ–­å¼¾æš–è«‡å£‡åœ°æ± çŸ¥å€¤æ¥è‡´é…ç—´ç¨šç½®ç·»ç«¹ç•œé€è“„ç¯‰ç§©çª’èŒ¶ç€å«¡ä¸­ä»²è™«æ²–å®™å¿ æŠ½æ³¨æ˜¼æŸ±è¡·é…é‹³é§è‘—è²¯ä¸å¼”åºå…†ç”ºé•·æŒ‘å¸³å¼µå½«çœºé‡£é ‚é³¥æœè²¼è¶…è…¸è·³å¾´å˜²æ½®æ¾„èª¿è´æ‡²ç›´å‹…æ—æ²ˆçæœ•é™³è³ƒé®è¿½æ¤å¢œé€šç—›å¡šæ¼¬åªçˆªé¶´ä½å‘ˆå»·å¼Ÿå®šåº•æŠµé‚¸äº­è²å¸è¨‚åº­é€“åœåµå ¤æç¨‹è‰‡ç· è«¦æ³¥çš„ç¬›æ‘˜æ»´é©æ•µæººè¿­å“²é‰„å¾¹æ’¤å¤©å…¸åº—ç‚¹å±•æ·»è»¢å¡¡ç”°ä¼æ®¿é›»æ–—åå¦¬å¾’é€”éƒ½æ¸¡å¡—è³­åœŸå¥´åŠªåº¦æ€’åˆ€å†¬ç¯å½“æŠ•è±†æ±åˆ°é€ƒå€’å‡å”å³¶æ¡ƒè¨é€å…šæ‚¼ç›—é™¶å¡”æ­æ£Ÿæ¹¯ç—˜ç™»ç­”ç­‰ç­’çµ±ç¨²è¸ç³–é ­è¬„è—¤é—˜é¨°åŒæ´èƒ´å‹•å ‚ç«¥é“åƒéŠ…å°ç³å³ åŒ¿ç‰¹å¾—ç£å¾³ç¯¤æ¯’ç‹¬èª­æ ƒå‡¸çªå±Šå±¯è±šé “è²ªéˆæ›‡ä¸¼é‚£å¥ˆå†…æ¢¨è¬é‹å—è»Ÿé›£äºŒå°¼å¼åŒ‚è‚‰è™¹æ—¥å…¥ä¹³å°¿ä»»å¦Šå¿èªå¯§ç†±å¹´å¿µæ»ç²˜ç‡ƒæ‚©ç´èƒ½è„³è¾²æ¿ƒæŠŠæ³¢æ´¾ç ´è¦‡é¦¬å©†ç½µæ‹æ¯èƒŒè‚ºä¿³é…æ’æ•—å»ƒè¼©å£²å€æ¢…åŸ¹é™ªåª’è²·è³ ç™½ä¼¯æ‹æ³Šè¿«å‰èˆ¶åšè–„éº¦æ¼ ç¸›çˆ†ç®±ç®¸ç•‘è‚Œå…«é‰¢ç™ºé«ªä¼æŠœç½°é–¥ååŠæ°¾çŠ¯å¸†æ±ä¼´åˆ¤å‚é˜ªæ¿ç‰ˆç­ç•”èˆ¬è²©æ–‘é£¯æ¬ç…©é ’ç¯„ç¹è—©æ™©ç•ªè›®ç›¤æ¯”çš®å¦ƒå¦æ‰¹å½¼æŠ«è‚¥éå‘é£›ç–²ç§˜è¢«æ‚²æ‰‰è²»ç¢‘ç½·é¿å°¾çœ‰ç¾å‚™å¾®é¼»è†è‚˜åŒ¹å¿…æ³Œç­†å§«ç™¾æ°·è¡¨ä¿µç¥¨è©•æ¼‚æ¨™è‹—ç§’ç—…æçŒ«å“æµœè²§è³“é »æ•ç“¶ä¸å¤«çˆ¶ä»˜å¸ƒæ‰¶åºœæ€–é˜œé™„è¨ƒè² èµ´æµ®å©¦ç¬¦å¯Œæ™®è…æ•·è†šè³¦è­œä¾®æ­¦éƒ¨èˆå°é¢¨ä¼æœå‰¯å¹…å¾©ç¦è…¹è¤‡è¦†æ‰•æ²¸ä»ç‰©ç²‰ç´›é›°å™´å¢³æ†¤å¥®åˆ†æ–‡èä¸™å¹³å…µä½µä¸¦æŸ„é™›é–‰å¡€å¹£å¼Šè”½é¤…ç±³å£ç’§ç™–åˆ¥è”‘ç‰‡è¾ºè¿”å¤‰åéç·¨å¼ä¾¿å‹‰æ­©ä¿å“ºæ•è£œèˆ—æ¯å‹Ÿå¢“æ…•æš®ç°¿æ–¹åŒ…èŠ³é‚¦å¥‰å®æŠ±æ”¾æ³•æ³¡èƒä¿¸å€£å³°ç ²å´©è¨ªå ±èœ‚è±Šé£½è¤’ç¸«äº¡ä¹å¿™åŠå¦¨å¿˜é˜²æˆ¿è‚ªæŸå†’å‰–ç´¡æœ›å‚å¸½æ£’è²¿è²Œæš´è†¨è¬€é °åŒ—æœ¨æœ´ç‰§ç¦åƒ•å¢¨æ’²æ²¡å‹ƒå €æœ¬å¥”ç¿»å‡¡ç›†éº»æ‘©ç£¨é­”æ¯å¦¹æšæ˜§åŸ‹å¹•è†œæ•åˆæœ«æŠ¹ä¸‡æº€æ…¢æ¼«æœªå‘³é­…å²¬å¯†èœœè„ˆå¦™æ°‘çœ çŸ›å‹™ç„¡å¤¢éœ§å¨˜åå‘½æ˜è¿·å†¥ç›ŸéŠ˜é³´æ»…å…é¢ç¶¿éººèŒ‚æ¨¡æ¯›å¦„ç›²è€—çŒ›ç¶²ç›®é»™é–€ç´‹å•å†¶å¤œé‡å¼¥å„å½¹ç´„è¨³è–¬èºé—‡ç”±æ²¹å–©æ„‰è«­è¼¸ç™’å”¯å‹æœ‰å‹‡å¹½æ‚ éƒµæ¹§çŒ¶è£•éŠé›„èª˜æ†‚èå„ªä¸äºˆä½™èª‰é å¹¼ç”¨ç¾Šå¦–æ´‹è¦å®¹åº¸æšæºè‘‰é™½æº¶è…°æ§˜ç˜è¸Šçª¯é¤Šæ“è¬¡æ›œæŠ‘æ²ƒæµ´æ¬²ç¿Œç¿¼æ‹‰è£¸ç¾…æ¥é›·é ¼çµ¡è½é…ªè¾£ä¹±åµè¦§æ¿«è—æ¬„ååˆ©é‡Œç†ç—¢è£å±¥ç’ƒé›¢é™¸ç«‹å¾‹æ…„ç•¥æŸ³æµç•™ç«œç²’éš†ç¡«ä¾¶æ—…è™œæ…®äº†ä¸¡è‰¯æ–™æ¶¼çŒŸé™µé‡åƒšé ˜å¯®ç™‚ç­ç³§åŠ›ç·‘æ—å˜å€«è¼ªéš£è‡¨ç‘ æ¶™ç´¯å¡é¡ä»¤ç¤¼å†·åŠ±æˆ»ä¾‹éˆ´é›¶éœŠéš·é½¢éº—æš¦æ­´åˆ—åŠ£çƒˆè£‚æ‹é€£å»‰ç·´éŒ¬å‘‚ç‚‰è³‚è·¯éœ²è€åŠ´å¼„éƒæœ—æµªå»Šæ¥¼æ¼ç± å…­éŒ²éº“è«–å’Œè©±è³„è„‡æƒ‘æ æ¹¾è…•

preview_kanji_check: False

kanji_check_ignores:é¾ï¼ˆï¼‰

@if preview_kanji_check and preview {
                            .madoko {  replace : "/([^\u0000-\u33FF&kanji_check_ignores;&joyo_kanji;])/\
                          \/[\1]{color:blue;} /g" ; } 
                                    }



      <!-- ----------------------------------- !-->
      <!-- other general replacements          !-->
      <!-- ----------------------------------- !-->

    <!-- Kaeriten unit. The characters used are the "real" unicode kaeriten chars., but the .kaeriten unit is for making sure they render properly in the preview -->

.kaeriten {css-vertical-align: -0.5em; css-color: red;}

reten         : [ã†‘]{.kaeriten}
ichiten       : [ã†’]{.kaeriten}
niten         : [ã†“]{.kaeriten}
santen        : [ã†”]{.kaeriten}
ueten         : [ã†–]{.kaeriten}
nakaten       : [ã†—]{.kaeriten}
shitaten      : [ã†˜]{.kaeriten}

@if preview {
    .madoko { replace : "/([ã†‘ã†’ã†“ã†”ã†–ã†—ã†˜])/[\1]{.kaeriten}/g"; }  
            }



Sample  { replace : "~ Begin SampleBlock&nl;\
                    ````&nl;&source;&nl;````&nl;\
                    ---- &nl;&source;&nl;\
                    ~ End SampleBlock" }


      <!-- Sanskrit (Skt.), Pali (Pl.), Japanese (Jp.) and Chinese (Ch.) !-->

.madoko { replace : "/((?:Skt)|(?:Pl))\. \
                    ((?:(?:\\\s)|\S)+)/\
                    \1. [\2]{.foreign}/g"  ;

          replace : "/((?:Ch)|(?:Jp))\. \
                    ((?:(?:\\\s)|[^\s])+?)\
                    ([&base_kanji_range;\s\;\)?])/\
                    \1. [\2]{.foreign}\3/g"  ;  }

      <!-- underline up to five lines !-->

.madoko { replace :  "/__(.*?)(\n?)(.*?)(\n?)(.*?)(\n?)(.*?)(\n?)(.*?)__/[\1]{.underline}\2[\3]{.underline}\4[\5]{.underline}\6[\7]{.underline}\8[\9]{.underline}/gm" ; }

      <!-- multi-color highlights; the top line is a multi-line version that doesnt seem to work! //replace : "/!(.+?)((\n.*?)*?)!(b|g|y|o|r|pk)/baby[\1\2]{.\4}/gm" ; -->

.madoko { replace : "/!(.+?)!(b|g|y|o|r|pk)/[\1]{.\2}/g" ;}

      <!--  default highlight; the top line is a multi-line version that doesnt seem to work  //replace : "/!((\n?.+?)*?)!/[\1]{.highlight}/gm" ; !-->

.madoko { replace : "/!(.+?)!/[\1]{.highlight}/gm" ;  }

      <!--  changes single asterix to bold; requires that first and last character are non-spaces  !-->

.madoko { replace : "/\*(\S.*?)((\n.*?\S){0,5})\*/[\1\2]{.bold}/gm"; }

.bold{font-weight:bold; tex-cmd:"\bfseries";}


      <!-- used for parallel translations to take the line heading ã€xxã€‘ and making that the paragraph style for that line !-->

parallel-brackets-shortcut: True

@if parallel-brackets-shortcut  {
                        .madoko { replace : "/^ã€(.*)ã€‘(.*$\n(^.+\n)*)/\
                                            ~ begin \1&nl;\
                                            ã€\1ã€‘\2\
                                            ~ end \1&nl;/gm" ; } }

percent_comments: False

@if percent_comments {
              .madoko{  replace : "/\u0025(.*)/<!--\1!-->/g"  ; } }

.foreign  { font-style:italic; }

.underline {  text-decoration : "underline" ;
              tex-cmd         :   "\uline"  ; }

body{ css-font-family:  "&main_font;",
                        "&cjk_main_font;",
                        "&japanese_font;",
                        "&cjkfallback_font;" ; }

BlockQuote {  font-style            : "normal"  ;
              css-background-color  : LightGray ;
              css-line-height       : 1.2 em    ;
              tex-cmd               : "\setlength{\baselineskip}{1.2 em}";  }

      <!-- this needs to be added to `pre` to workaround a bug --->

pre   {  color  : "Black";  }

add_these_commands_to_blockquote_if_it_is_acting_funny {
                    css-line-height : 1;
                    tex-cmd     : "\setlength{\baselineskip}{1.2 em}";  }

japanese {  css-color : blue      ; 
            tex-cmd   : "\jpfont" ; }

.li { css-line-height : 1.2;
      tex-cmd         : "\setlength{\baselineskip}{1.2 em}" ; }

.highlight {  background-color  : &default_highlight_color;; }

.blue, .b   { background-color  : cyan    ; }

.green, .g  { background-color  : lime    ; }

.orange, .o { background-color  : orange  ; }

.yellow, .y {  background-color : yellow  ; }

.red, .r    {  background-color :  red    ; }

.pink, .pk  {  background-color : pink    ; }

.authorname { font-size : medium  }

.authoraddress {  font-size : small ; }

.authoremail {  font-size   : small     ;
                font-family : monospace ; }

.footnote{  tex-cmd: "\setlength{\baselineskip}{1.3 em}"; }

.code { background-color: #EEE          ;
        padding: 0ex 0.2ex 0.1ex 0.2ex  ;
        border-radius: 0.5ex            ; }

dblspace {  css-line-height: 2;
            tex-cmd     : "\setlength{\baselineskip}{2 em}" ;  }

      <!-- originally `tate` was set to `body` rather than as a custom block !-->

tate {  //font-family       : "ï¼­ï¼³ æ˜æœ" ;
        //line-height       : 4em       ;
        //height            : 30%       ;
        text-align        : left     ;
        right             : 0px       ;
        margin            : 3 em      ;
        -ms-writing-mode  : tb-rl     ;
        -webkit-writing-mode :  vertical-rl ;
        writing-mode      :     vertical-rl ; }

.v {  writing-mode          : vertical-rl ;
      -webkit-writing-mode  : vertical-rl ;
      font-size             : 12px        ; }

.warichu {  display         : inline-table  ;
            vertical-align  : top           ; }

.warichu-left, .warichu-right { font-size :50%        ;
                                display   : table-row ; }

versechars  {  color: &verse_text_color ; }

verse { background-color: &verse_background_color ;  }

CBETA_indents: True
CBETA_linenumbers: True

cbeta {           /*T or an X is the beginning of new line, add a break before it*/
        replace : "/^([TX])(.*\n)/\1\2&nl;/mg";
                  /*deals with the first line of the column */
        replace : "/.*(.{3}[abc])01ï¼š(.*)/**\1**: &nl;[\2]{margin-left:1.2em}/g";  }

@if CBETA_linenumbers {
                cbeta { /*deals with numbers for every fifth line (line numbers ending in 0 and 5 */
                        replace : "/.*(.[05])ï¼š/[\1:]{margin-left:-1.2em}/g"; }  }

cbeta {            /*gets rid of line numbers for all other lines, currently only works for T and X citations */
        replace : "/[TX].*ï¼š//g";  
                   /*full width space in gatha */
        replace : "/ ((.*?[\u4E00-\u9FFF].*?){3,5}) {1,2} ((.*?[\u4E00-\u9FFF].*){3,5})/[ã€€\1ã€€ã€€\3 ]{.versechars}\\/g"
                   /*deals with the parentheses */ 
          replace : "/\(/\(/g"; }

cbetafootnotes  {           /*deals with the footnote anchors */
                  replace : "/\[([^^].*?)\]([\u4E00-\u9FFF])/[\2]{color:red}[^fn-\1]/g";  
                            /*deals with the footnotes */
                  replace : "/\[([^^].*?)\]ï¼š/&nl;[^fn-\1]:/g"; 
                            /*deals with the first line of the column */
                  replace : "/.*(.{3}[abc])01ï¼š(.*)/**\1**: &br;[\2]{margin-left:1.2em}\\/g";
                            /*deals with numbers for every fifth line*/
                  replace : "/.*(.[05])ï¼š(.*)/\1:\2\\/g";  
                            /*gets rid of line numbers for all other lines, and adds line breaks */
                  replace : "/[TX].*ï¼š(.*)/[\1]{margin-left:1.2em}\\/g";
                            /*full width space in gatha */
                  replace : "/ ((.*?[\u4E00-\u9FFF].*?){3,5}) {1,2} ((.*?[\u4E00-\u9FFF].*?){3,5})/[ã€€ã€€\1ã€€ã€€ã€€\3 ]{.versechars} /g"
                            /*deals with the parentheses */
                replace : "/\(/\(/g";  }

cbeta_reformatting {            /*for footnote anchors */
                      replace : "/\[([^^].*?)\]([ã€‚â–¡\u4E00-\u9FFF])/[\2]{color:red}[^fn-\1]/g"; 
                                /*deals with the footnotes */ 
                      replace : "/\[([^^].*?)\]:/[^fn-\1]:/g";
                                /*for the first line of the column */
                      replace : "/.*(.{3}[abc])01ï¼š(.*)/**[<\1>]{background-color:salmon;}**\2\\/g";
                                /*deals with numbers for every fifth line (line numbers ending in 0 and 5 */
                      replace : "/.*(.[05])ï¼š(.*)/[\1:]{.pk}\2\\/g"; 
                                /*gets rid of line numbers for all other lines, and adds line breaks currently only works for T and X citations */ 
                      replace : "/[TX].*?ï¼š(.*)/\1\\/g";  
                                /*deals with the parentheses */
                      replace : "/\(/\(/g";  
                                /*full width space in gatha */
                      replace : "/([\u4E00-\u9FFF])  ([\u4E00-\u9FFF])/\1ã€€ã€€\2/g"  }

<!-- some fixes for minor problems with the rendering engine, whereby it doesn't insert a space before certain latex tags-->

.dd { }

primer {  replace : "/(.+)/Is the Length of Your String: `\1` \
                      &br;&br;\
                      Which is of legnth:&nl;\
                      ~ begin length &nl;\
                      \1&nl;\
                      ~ end length &nl;\
                      A Prime Number? &br;\
                      ~ begin primecheck &nl;\
                      \1&nl;\
                      ~ end primecheck &nl;/g"; }


length {  replace : "/./   /g";
          replace : "/   $/â†“  /";
          replace : "/(.*)/\
                    ```&nl;\
                    \1&nl;\
                    1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 \
                    26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 \
                    51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 \
                    76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 &nl;\
                    ```&nl;/i"; }


primecheck {  replace : "/./1/g";
              replace : "/^.?$|^(..+?)\1+$/No, and its smallest divisor is &nl;\
                        ~ begin length &nl;\
                        \1&nl;\
                        ~ end length &nl;/g";
              replace : "/^1+/[YES!]{font-size:150%;}/"; }

paralleltrans { replace : "/(.*)/\1 \\/g"; 
                replace : "/\[([^\^])/\[\1/g";  }

mybibl  { font-size : 12pt;
          before    : "# &name-references; {-} &nl;";
          tex-cmd   : "\setlength{\baselineskip}{0.75em}";
          tex-cmd   : "\setlength{\parskip}{0.5em}"; }


.madoko{  replace :  "/([wW])([iI])([lL])([dD])/[[\1]{color: Red}[\2]{color: Blue}[\3]{color: Magenta}[\4]{color: Cyan}]{font-size:125%; font-family:Comic Sans MS;}/g"; }

      <!-- its wild -->

<!-- END:Style -->

<!-- EXPERIMENTAL! Tategaki for madoko--->

<!-- BEGIN:Tategaki -->

Doc Class: [landscape,11pt,a4paper]bxjsarticle

Package: [default]zxjatype


      <!-- japanese article class that workds with zxjatype package. I'm using this because it basically looks better by default, (more natural spacing, kerning) but I'm not totally sure of all it's features. -->

      <!-- Flowframes setup -->

Package: flowfram
Tex Header: \newflowframe{\textheight}{\textwidth}{0pt}{\textheight}[mainframe] 

      <!-- usage: \newflowframe[âŸ¨page listâŸ©]{âŸ¨widthâŸ©}{âŸ¨heightâŸ©}{âŸ¨xâŸ©}{âŸ¨yâŸ©}[âŸ¨labelâŸ©]%* adds a border to the frame for troubleshooting purposes -->

Tex header: \setflowframe{1}{angle=-90} 

      <!-- Font setup -->

Tex header: \setmainfont{&main_font;}

Tex header: \setCJKmainfont[Scale=MatchLowercase,Mapping=tex-text,RawFeature={vertical}]{&cjk_main_font;}

Tex Header: \setCJKmainfont[FallBack,RawFeature={vertical}]{&cjkfallback_font;}


Tex header:\setCJKsansfont[FallBack=&cjkfallback_font;,Scale=MatchLowercase,Mapping=tex-text,RawFeature={vertical}]{&cjk_sans_font;}

Tex header: \newCJKfontfamily\vertical[FallBack=&cjkfallback_font;,Scale=MatchLowercase,Mapping=tex-text,RawFeature={vertical}]{&cjk_sans_font;}

Tex header: \newCJKfontfamily\horizontal[FallBack=&cjkfallback_font;,Scale=MatchLowercase,Mapping=tex-text]{&cjk_main_font;}


      <!-- a thingee to adjust the baseline between chinese and western characters (only a problem with vertical text it seems) in Latex -->

Tex header    : \let\CJKsymbolOrig\CJKsymbol
Tex header    : \let\CJKpunctsymbolOrig\CJKpunctsymbol
Tex header    : \newcommand*\CJKmovesymbol[1]{\raise.35em\hbox{\CJKsymbolOrig{#1}}}
Tex header    : \newcommand*\CJKmovepunctsymbol[1]{\raise.35em\hbox{\CJKpunctsymbolOrig{#1}}}
Tex header    : \newcommand*\CJKmove{\punctstyle{plain}
Tex header    :  \let\CJKsymbol\CJKmovesymbol
Tex header    :  \let\CJKpunctsymbol\CJKmovepunctsymbol}
Tex Doc Header: \CJKmove

<!-- END:Tategaki -->

[TITLE]

[TOC]


Block Elements
====================

Double Spacing
--------------------

- use `~dblspace` custom block for double spacing

Bibliography
--------------------

- use `~mybibl` for a closely typeset bibliography (which also doesn't appear in the TOC)
- Define `name-references` to be the title bibliography. For example `name-references: å‚è€ƒæ–‡çŒ®` 

Block Quotes
--------------------

- `blockquotes` using `>` at the beginning of the line are set in single space (by default) but not in the default italic face. 

Parallel Translation
--------------------

- The `paralleltrans` custom block makes lines that are adjacent to one another render with a break between them (normally they would simply concatenate). It also converts any string `[` to `\[` so that the renderer doesn't mistake these for link references (however, actually, this might need to be tweaked, because, what if you want a link?). In fact this isn't strictly speaking necessary, since Madoko just ignores anything in brackets but without a link definition, so more or less, this is just to supress the error message for unlinked text in brackets [like this].

-*this needs to be improved by using a proper multi-line flag; cf. Gyonen document




Inline Elements
====================

- use `.japanese` to apply a japanese font, as opposed to default loaded chinese fonts. May be able to use as a custom block but haven't tried it. If not I should re-write it so that it does that. !I have changed this from `.japanese` to `japanese` which I think will make it work as a custom block but not sure if it will work as an inline style with `[...]{. ---}` syntax.!

Furigana/Rubies (ver. 2.0)
--------------------

The Furigana unit allows for you to type some characters (typically Chinese characters) followed by some other characters (typically hiragana or katakana) surrounded by parentheses (or other delimiter) in order to render what are generally called "rubies" or "furigana. That is, you can type `<chinese characters>(<furigana>)` i.e. typing `æ¼¢å­—\(&lpar;\)ã‹ã‚“ã˜\(&rpar;\)` will give æ¼¢å­—(ã‹ã‚“ã˜), which will render in HTML as `<ruby>æ¼¢å­—<rt>ã‹ã‚“ã˜</rt></ruby>` and in &logolatex; as `\ruby{æ¼¢å­—}{ã‹ã‚“ã˜}`. This requires loading the `ruby` package for Latex, which is done in this file.[^nb-ruby]

[^nb-ruby]: nb: the `ruby` package apparently isn't set up to work with `xecjk` package, so may not work properly 100&perc; of the time. 



This is achieved by first applying the style `.rubies` to the whole string automatically via a regular expression on the `.madoko` class. By default, the grep pattern detects any string of unicode Kanji characters (i.e. in the range `\u4E00-\u9FFF`), followed by an open parentheses `&lpar;` followed by several Katakana or Hiragana Characters (i.e in the range `\u3040-\u30FF`)  as well as 'spacers' (explained below), and then the closed parentheses `&rpar;`, thus transforming `æ¼¢å­—\(&lpar;\)ã‹ã‚“ã˜\(&rpar;\)` into `[æ¼¢å­—\(&lpar;\)ã‹ã‚“ã˜\(&rpar;\)]{.rubies}`. 

The range of characters detected as the base characters can be set with the metadata key `base_kanji_range`, though this would only be useful if you want to automatically detect non-kanji characters as the base for furigana. The range of characters that is automatically detected as "rubies" can be set similarly with `furigana_range.` By default, this does not include alphanumeric characters, nor does it include kanji, as this would lead to 'false positives' for furigana.[^482] If you did want to automatically detect letters, in addition to Hiragana and Katakana, you would write `furigana_range: \u3040-\u30FFa-zA-Z` in the header. Notice that these must be formatted like a regex range. 

[^482]: For example in the case of dates following names i.e. ç¹”ç”°ä¿¡é•·(1534-1582) or parethetical expressions with kanji, i.e. ç„å¥˜(ä¸‰è”µæ³•å¸«), which should not be rendered as furigana. These situations could also be avoided by using 'full-width' parentheses ç¹”ç”°ä¿¡é•·ï¼ˆ1534-1582ï¼‰ instead of 'normal' parentheses, but the difference is difficult to see with fixed-width fonts, so may be difficult to troubleshoot.

If you only intent to make an 'unusual' furigana sequence once or twice in your document, then you can also just set the style `.rubies` on any string with furigana demarcated in parentheses. I.e. typing `[ğŸ…(santa&ensp;claus)]{.rubies}` will result in [ğŸ…(santa&ensp;claus)]{.rubies}.[^484]

[^484]: In this case the space `&ensp;` has to be escaped because it would otherwise be detected as a separator. 

You may also change the delimiters used for the furigana detector by setting `ruby_opening_delimiters` and `ruby_closing_delimiters` in the metadata.  For example `ruby_opening_delimiters` is defaulted the open parentheses `\(` (it has to be escaped with a backslash because it is a regex string), but you could also, for example use the "full width" parentheses `ï¼ˆ`or perhaps a "black bracket" `ã€` which may be easier to type while using a Japanese IME. You can actually use more than one delimiter, and mix-and-match between them, but having a standard style for a whole document would be preferred. 


A string of ruby characters enclosed by parentheses or whatever other delimiter you choose, by default will apply as the furigana for a string of base characters stretching back to the next non-base character, or space. Thus, for long strings of kanji, where only some characters require rubies, put a space before the characters to separate furigana characters from the non-furigana characters, e.g. `å¤§é™¸é–“ å¼¾é“å¼¾\((\)ã ã‚“ã©ã†ã ã‚“\()\)` renders as å¤§é™¸é–“ å¼¾é“å¼¾(ã ã‚“ã©ã†ã ã‚“). 

In Latex, this may render so that the furigana characters all bunch around the center of the base kanji string.  To avoid this, you can split up the 'blocks' of furigana with a spacer. Thus, we can split `ã ã‚“ã©ã†ã ã‚“` up into `ã ã‚“ ã©ã† ã ã‚“`, making the above example `å¼¾é“å¼¾\((\)ã ã‚“ ã©ã† ã ã‚“\()\)` render as å¼¾é“å¼¾(ã ã‚“ ã©ã† ã ã‚“). This is equivalent to writing`å¼¾\((\)ã ã‚“)é“\((\)ã©ã†)å¼¾\((\)ã ã‚“)` å¼¾(ã ã‚“)é“(ã©ã†)å¼¾(ã ã‚“), but saves key strokes.  This default delimiter for spacing is the normal space character ` `, but any number of such spacers can also be set with the metadata key `furigana_spacers`, for example, by setting it as the middle dot `ãƒ»` or a dash `-` (a dash will likely need to backslash-escaped), one could write `ã ã‚“ãƒ»ã©ã†ãƒ»ã ã‚“`, etc. 

Finally, for _okurigana_, characters that come after the base kanji, these can be rendered as 'rubies' by putting a vertical bar `|` before the characters in the base string. For example ä¸‰åƒ(ã•ã‚“ ãœã‚“|ãƒ)æ³•é–€(ã»ã† ã‚‚ã‚“) can be written by `ä¸‰åƒ\((\)ã•ã‚“ ãœã‚“|ãƒ)æ³•é–€\((\)ã»ã† ã‚‚ã‚“)`. Notice the `ãƒ` character is centered over a space character. This function would normally only be useful for rendering _kaeriten_ã€€è¿”ã‚Šç‚¹ or other typesetting used for literary chinese

For rendering in &logolatex; you can set the distance from the ruby with the metadata `rubysep`. 

For the HTML preview, setting `ruby_select` to `false` make is so that rubies are not selected with mouseover (though, apparently in Chrome, they will still be copied). `false` is default, though `true` would probably be considered "normal" behaivior.



Standard Kanji Checker
----------------------
If you set `kanji_check` to `True` in the metadata, it will highlight all non-standard (non-_jÅyÅ_ kanji å¸¸ç”¨æ¼¢å­—), based on the list from [this](https://0017.org/339.html) website (also found on [this](https://github.com/rime-aca/character_set?files=1) website). This should only display in the preview, and not in a rendered version. 

For whatever reason, this appears to only affect the body of the text, so if there are problems in the title, it's up to you to fix 'em!

Any string of characters as `kanji_check_ignores` will add it to the list of characters to ignore, and therefore not highlight. (For example, if you intend to use a non-_jÅyÅ_ kanji)





Italicized Foreign Word shortcut
----------------------------------------

- use `pl.`, `skt.`, `ch.`, and `jp.` to get italicized text (i.e. for foreign words). The italicized text should stop when it sees a `.`, `)`, `;`, `\`, or `,`  (so you can use `\/` to break) In the case of `jp.` and `ch.` it will also break at the next kanji character. Not that, for `pl.` and `skt.` the italicization doesn't stop at a space, so you have to explicitly tell it where to end.[^nb-didntwork] eg. skt. dharma, pl. dhamma, ch. fa; jp. hÅ æ³•

[^nb-didntwork]: I tried to fix this so you didn't need to explicitly tell it where to end, but it just wouldn't work. 

Shortcut for translation headings
--------------------

- For parallel translations, in particular, ones that use chinese or japanese, you can put a string inside of bold brackets (`ã€`and`ã€‘`) and that word will be applied as the paragraph style for that line. This currently only works for single lines but i'd like to get it to work for multiple lines in the future.

Comments Shortcut
--------------------

- You can use a percent sign (`&perc;`) to comments out anything on a line that appears after the `&perc;` sign. This is enabled by default, and can be disabled by setting `&percent_comments` to `false`. I'm not sure this trick is 100&perc; fool proof (i.e. without bugs or places where it will fuck up. Multi-line comments should use the regular comment feature (because I couldn't get the same thing to work for multi-line replacents).

Underline Shortcut
--------------------

- You can also use enclose text in double underscores `\(&underscore;&underscore;\)<text>\(&underscore;&underscore;\)` to __underline text like this__. This works in Tex with the `ulem` package but maybe I should use the `soul` or `soul-utf8` package. This currently works for up to 5 lines at a time (or maybe it was 4 lines), but I haven't figure out how to get it to work for an arbitrary number of lines yet.

Bold/Italic Emphasis
--------------------

- I have set text enclosed in single asterixes (`\(&ast;\)`) to be *bold* (the default is italics) so you should be able to get bold-italics by typing `\(&underscore;&ast;\)<text>\(&ast;&underscore;\)` like _*this*_.

Highlights
--------------------

### Default highlight

- You can use the property `.highlight` to give text a yellow background, i.e. for highlighting. You can change `.highlight` to be a different default color with the `default_highlight_color` property in the header.

### Default highlight shortcut

- I have also made a global replacement on the `.madoko` property such that surrounding a text (on a single line) with exclamation points `\(&excl;\)`[^nb-exclamation-points] like `\(&excl;\)<text>\(&excl;\)`
 gives the `text` the `.highlight` property. i.e. typing `\(&excl;\)highlight\(&excl;\)` makes !highlight!. 

[^nb-exclamation-points]: This only works with the standard exclamation points `\(&excl;\)` but not CJK "full width" exclamation points to force a unified syntax.

### Multi-color highlights

- I have also set the properties `.blue`, `.green`, `.yellow`, `.orange` `.pink` and `.red` to have [blue]{.blue},[^cyan] [green]{.green}, [yellow]{.yellow}, [orange]{.orange} [pink]{.pink} and [red]{.red} background highlights.
[^cyan]: well, more like "cyan" I guess.

#### Multi-color highlight shortcut

- Similar to the above "default" highlight, I have also made a way to abbreviate this using the same "text surrounded by exclamation points" syntax followed immediately by a "color-definer tag." That is to say type the default `\(&excl;\)highlight\(&excl;\)` combination immidiately followed by a `b`, `g`, `y`, `o`, `r` or `pk` will give (cyan) blue, (lime) green, yellow, orange, red, or pink hightlights. In otherwords, the syntax `\(&excl;\)<text>\(&excl;\)<b|g|y|o|r|pk>`, for example, `\(&excl;\)orange\(&excl;\)o` will give !orange!o as `b` will give !green!b, `y` will give !blue!y, `g` will give !yellow!g, `r` will give !pink!r, and `pk`[^why-pk] will give !red!pk.[^multiple-hightlights] 

[^why-pk]: had to use `pk` because `p` is taken by "paragraph"
[^multiple-hightlights]: Multiple highlights on one line occasionally pose a problem, especially if you try to use the "default" highlight (i.e. without specifying a color) in conjunction with the color-specific highlight. I have yet to figure out a way around this properly, so if you want both yellow and  another color highlight on the same line, you have to be explicit about it. i.e. typing `\(&excl;\)yellow\(&excl;\)y and \(&excl;\)blue\(&excl;\)b`ã€€works (!yellow!y and !blue!b), but `\(&excl;\)default_highlight\(&excl;\) and \(&excl;\)blue\(&excl;\)` (notice the missing `y` color definer) does not work right now. 


Special Characters
=======================

- special characters are `&ditto;` &ditto;, `&excl;` &excl;, `&about;` &about;, and `&approx;` &approx;

- &blacksanta;

Custom Blocks
====================

`Sample`
--------

This is just the `Sample` block copy and pasted from the stylesheet for the Madoko manual. It displays first the raw text, followed by the madoko rendered text. This is usesful for debugging. 

~ begin Sample

~ Sample
It's a sample inside of a sample. So Meta.
~ 

~ end Sample


CBETA
-------

Below is a test of both the `cbeta` and `tate` custom blocks for dealing with raw text from [CBETA]'s online viewer citations:
{font-size:14pt}

[CBETA]:  http://cbetaonline.dila.edu.tw/#/zh/T1851_010

[CBETA] (Chinese Buddhist Electronic Text Association) is an organization based in Taiwan that provides digital versions of many Chinese Buddhist works (and). [SAT] is a similar project based in Japan.

[SAT]:http://21dzk.l.u-tokyo.ac.jp/SAT/

This currently works with "raw" cbeta text, and is especially designed to handle text that retains its original (i.e. as it was originally printed formatting) (i.e. with a limited number of characters per column of text, rather than flowing/reflowing text). Basically, you can keep line numbers at the head of each line in the source text (such as `X40n0726_p0870c21`) as they are displayed in the [cbeta] viewer, but these are hidden in the rendered version by default.

It also automatically reformats the "verse" (jp. _ge_; zh. _ju_ åˆ) couplets by indenting them (actually it just adds some whole-width spaces) and spacing the couplets (also with whole-width spaces). It also adds color to the characters, which is set by default in the header of this file, but can be changed by setting `verse_text_color`. I also added a block element called `verse` which simply adds a background color to the block. Again this is set by default in the header of this file, and can be set by `verse_background_color`.

This also automagically changes the cbeta citation format that is output as raw data to a markdown format. However, I still think best practice should be to change the citations to madoko format in the text itself there is a comment above for how to do that with a normal text grep (rather than an automatic grep)!(but I should put that here. and also be sure it works)!.  I also think it will mess up if I try to insert my own footnotes in normal madoko format, but I haven't quite worked out how to fix this yet. (!needs some kind of command like `[^\^]` as part of the regex to ignore text with `^` at the beginning, but that wasn't working so well)!

This basic system should also work with with text from SAT with some tweaking, but haven't tried it yet.

I also want to implement automatic _warichu_ formatting.Also haven't figured out at all how to format the _tategaki_ box it seems as though it will require some tweaking, perhaps with the `.indent` styling?? Not sure. Couldn't get it to work properly earlier. Also yeah, good luck getting this to work with &logolatex; hahahahaha oh cry.



~~ begin cbeta

 ã€Šå››åˆ†å¾‹éš¨æ©Ÿç¾¯ç£¨ç–æ­£æºè¨˜ã€‹å·7

X40n0726_p0870c21ï¼š[3]è–æ³•ã€‚!ç”±æ­¤æˆ’æ³•èƒ½!æˆæ–¼è–ã€‚é›–å‡¡å¤«ä¸­å—ã€‚äº¦å½°æ­¤è™Ÿã€‚éš¨
X40n0726_p0870c22ï¼šå…·èº«å£ç‚ºå…·ã€‚èƒ½æã€‚æå³æ˜¯ç ´ã€‚åˆ†æˆè¨˜ç”¨ã€‚å³æˆå–„è¨˜æ¥­
X40n0726_p0870c23ï¼šéæƒ¡ç„¡è¨˜ä¹Ÿã€‚åˆæ­¤è¨˜æ¥­ã€‚èƒ½æœ‰åŠ›ç”¨ã€‚æ•…æ›°è¨˜ç”¨ã€‚æ„Ÿä¸‹ã€‚å¦‚
X40n0726_p0870c24ï¼šå¤§éˆ”ã€‚å•äº‘ä»Šå—å…·æˆ’ã€‚æ‹›ç”Ÿæ¨‚æœã€‚ç‚ºå—ç‚ºéš¨è€¶ã€‚ç­”å—æ˜¯

X40n0726_p0871a01ï¼šç·£åŠ©ã€‚æœªæœ‰è¡ŒåŠŸã€‚å¿…é ˆå› éš¨å°å¢ƒé˜²æ“¬ã€‚ä»¥æ­¤éš¨è¡Œã€‚è‡³å¾—
X40n0726_p0871a02ï¼šè–æœã€‚ä¸è¦ªå—é«”ã€‚å½¢ä¿±ã€‚ä¸€å—[c1]å·²å¾Œã€‚çµ‚è‡³ç›¡å½¢ã€‚å³å…«ç¨®ç„¡
X40n0726_p0871a03ï¼šä½œã€‚å±¬å½¢ä¿±ç„¡ä½œä¹Ÿã€‚ç›¸å¾ã€‚å¾ä½œæˆ’æ•…ã€‚åˆè‡ªèƒ½èµ·å¾Œéš¨è¡Œ
X40n0726_p0871a04ï¼šæ•…ã€‚æ‰€ä»¥æˆå–„è¨˜æ¥­ä¹Ÿã€‚è‹¥æ“šå¤šè«–ã€‚é€šå››å¿ƒå¾—æˆ’ã€‚æ•…å½¼å•
X40n0726_p0871a05ï¼šæ›°ã€‚ç‚ºå–„å¿ƒä¸­å¾—æˆ’ã€‚ç‚ºä¸å–„å¿ƒä¸­ã€‚ç‚ºç„¡è¨˜å¿ƒä¸­ã€‚ç‚ºç„¡å¿ƒ
X40n0726_p0871a06ï¼šä¸­å¾—æˆ’è€¶ã€‚ç­”æ›°ä¸€åˆ‡ç›¡å¾—ã€‚å…ˆä»¥å–„å¿ƒã€‚ç¦®åƒ§è¶³[c2]å·²ã€‚å—è¡£
X40n0726_p0871a07ï¼šé‰¢ã€‚æ±‚å’Œå°šã€‚å•æ¸…æ·¨[c3]å·²å—æˆ’ã€‚äº’è·ªåˆæŒã€‚ç™½å››ç¾¯ç£¨[c4]å·²ã€‚ç›¸
X40n0726_p0871a08ï¼šçºŒå–„å¿ƒæˆ’è‰²æˆå°±ã€‚æ˜¯è¬‚å–„å¿ƒä¸­å¾—æˆ’ã€‚è‹¥å…ˆæ¬¡ç¬¬æ³•ä¸­ã€‚
X40n0726_p0871a09ï¼šå¸¸è¡Œå–„å¿ƒã€‚èµ·è«¸æ•™æ¥­ã€‚ç™½å››ç¾¯ç£¨æ™‚ã€‚æˆ–èµ·è²ªæ¬²ç‹æšç­‰
X40n0726_p0871a10ï¼šè«¸ä¸å–„å¿µã€‚æ–¼æ­¤å¿ƒä¸­æˆå°±æˆ’è‰²ã€‚æ˜¯åä¸å–„å¿ƒå¾—æˆ’ä¹Ÿã€‚
X40n0726_p0871a11ï¼šä»¥æœ¬å–„å¿ƒå–„æ•™åŠ›æ•…ã€‚è€Œå¾—æ­¤æˆ’ã€‚éä¸å–„å¿ƒåŠ›ä¹Ÿã€‚å…ˆä»¥
X40n0726_p0871a12ï¼šå–„å¿ƒèµ·æ–¼æ•™æ¥­ã€‚ç™½å››ç¾¯ç£¨æ™‚ã€‚æˆ–ç¡æˆ–çœ ã€‚æˆ–æ–¼çœ å¿ƒè€Œ
X40n0726_p0871a13ï¼šå¾—æˆ’è‰²ã€‚æ˜¯åç„¡è¨˜å¿ƒä¸­è€Œå¾—æˆ’ä¹Ÿã€‚å…ˆä»¥å–„å¿ƒèµ·æ–¼æ•™
X40n0726_p0871a14ï¼šæ¥­ã€‚ç™½å››ç¾¯ç£¨æ™‚ã€‚å…¥æ»…ç›¡å®šã€‚å³æ–¼çˆ¾æ™‚æˆå°±æˆ’è‰²ã€‚æ˜¯å
X40n0726_p0871a15ï¼šç„¡å¿ƒä¸­è€Œå¾—æˆ’ä¹Ÿã€‚å½¼è«–é›–é€šå¾Œä¸‰å¿ƒã€‚çš†ç”±å‰æœ‰å–„è¨˜
X40n0726_p0871a16ï¼šæ¥­æ•…ã€‚é€šæ„Ÿç™¼ä¹Ÿã€‚å¦‚å¾‹ã€‚æŒ‡åèª¦ä¹Ÿã€‚æ˜¯è‰²ã€‚å±¬å–„è‰²ä¹Ÿã€‚ 
X40n0726_p0871a17ï¼šè«¸å¡µã€‚å³ä¸Šä¾èº«å£æˆã€‚ä¸é›¢è‰²ç­‰å¡µä¹Ÿã€‚å°èªªã€‚å³ä¸å¯è¦‹
X40n0726_p0871a18ï¼šç„¡å°èªªä¹Ÿã€‚é›–ä¸‹ã€‚é›–æ›°å¤šå¼•æ˜è­‰ã€‚åŠæ‰€é¡¯äºŒæˆ’ã€‚ä¿±æ˜¯è‰²
X40n0726_p0871a19ï¼šä¹Ÿã€‚ä¸­é™°ã€‚æ­»ç”ŸäºŒæœ‰ä¸­ã€‚å…¶è‰²å¾®ç´°æ•…ã€‚è±ˆç´„å¡µå°ã€‚è¨€å¡µå°
X40n0726_p0871a20ï¼šå‰‡å¡µéº¤æ•…ã€‚é¡¯æ­¤æ˜¯ç´°è‰²ä¹Ÿã€‚è«¸å¸«æ©«åˆ¤ã€‚å¦‚ä¸Šæ‰€å‡ºè€…æ˜¯
X40n0726_p0871a21ï¼šä¹Ÿã€‚æ„è¨€å¦‚æ­¤ã€‚è¨€å…¶æˆ’é«”è‰²é‡ã€‚æ„äº‘å¦‚ä¸­é™°è‰²ä¹Ÿã€‚ 
X40n0726_p0871a22ï¼šåˆ¥è€…ã€‚æ„è¬‚ä½•ä»¥ä½œæˆ’æ˜¯è‰²ã€‚ç„¡ä½œéè‰²è€…ã€‚åˆ†é€šå¤§ä¹˜ã€‚æœ‰
X40n0726_p0871a23ï¼šæ–½ç”Ÿæˆä½›ç­‰ç¾©æ•…ã€‚æ¥­ä¸‹ã€‚å–„æƒ¡ç­‰æ¥­ã€‚è‹¥ç„¡å¿ƒè€…ã€‚ä¸æˆæ¥­
X40n0726_p0871a24ï¼šä¹Ÿã€‚æ•…ä¸‹ã€‚å‰æœ‰é–€è«–ã€‚[c5]ä½†ç´„è‰²ç‚ºä½œæˆ’é«”ã€‚ä»ŠåŠ æ–¼å¿ƒã€‚æ•…å¾—

(CBETA, X40, no. 726, p. 870, c20-p. 871, b4)

[3]ï¼šæœƒæœ¬ç–å·ä¸‰ä¹‹äº”[c1]ï¼šã€åçºŒã€‘å·³ [c2]ï¼šã€åçºŒã€‘å·³ [c3]ï¼šã€åçºŒã€‘å·³ [c4]ï¼šã€åçºŒã€‘å·³ [c5]ï¼šã€åçºŒã€‘ä¼¹


~~ end cbeta



```
for body text:
find: \[(.+?)\](.)
replace: $2[^fn-$1]
```

%slightly modified so i'm not sure it works 100%

```
for footnotes:
find: \[([^\[]+?)\]:
replace: [^fn-$1]:
```


Prime Number Checker Module
---------------------------

This is an implementation of the Regex prime number checker code that I found online. The original implmentation was basically the following:

> Please type a string of characters below the line `~ primer` to check the legnth of the string is Prime:

Followed by the lines:

```
~ primer
(any string of characters goes here)
~
```

This module is made up of three classes: `primer` `length` and `primecheck`. The `primer` class simply prints the given input with some explanatory text and then feeds the input into `length` and `primecheck`. `legnth` prints a chart of the legnth of the string that it is given, while `primecheck` is what actually checks if the string is prime or not.  `primecheck` first converts the string to a string of `1`s (i.e. a number in unary, whereby the number of ones, that is, the length of the string, is the number to be checked), and then compares that string against the Regular Expression`^.?$|^(..+?)\1+$`. This Regex actually checks that a number is *not* prime, rather than if it is prime, so if the legnth of the input string it is *not* prime, `primecheck` prints a statement says so, and then feeds the regex group `\1`, which is the string of the legnths of the smallest factor, into `length` to displays a chart giving the smallest factor. Otherwise, if the length of the string *is* prime, then it prints a statement saying as much. Anyway, it works like this:

~ primer
12345
~
----------------------------------
~ primer
123456
~
----------------------------------
Note that while the actual prime-checking regex requires a string of all the same characters, `primecheck` automatically converts any string to such a string. Also note that, while this will technically work with a string of any legnth, the chart for `length` only goes up to 100, and probably strings longer than that may be umm... a bit tough on this poor little regex.